"use strict";(self.webpackChunkbiblioteca=self.webpackChunkbiblioteca||[]).push([[593],{593:(Pe,T,l)=>{l.r(T),l.d(T,{BookModalComponent:()=>je});var e=l(4438),k=l(6057),u=l(6600),O=l(177);const N=["*"],W=new e.nKC("MAT_CARD_CONFIG");let I=(()=>{class n{constructor(t){this.appearance=t?.appearance||"raised"}static{this.\u0275fac=function(a){return new(a||n)(e.rXU(W,8))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:4,hostBindings:function(a,i){2&a&&e.AVh("mat-mdc-card-outlined","outlined"===i.appearance)("mdc-card--outlined","outlined"===i.appearance)},inputs:{appearance:"appearance"},exportAs:["matCard"],standalone:!0,features:[e.aNF],ngContentSelectors:N,decls:1,vars:0,template:function(a,i){1&a&&(e.NAR(),e.SdG(0))},styles:['.mat-mdc-card{display:flex;flex-direction:column;box-sizing:border-box;position:relative;border-style:solid;border-width:0;background-color:var(--mdc-elevated-card-container-color, var(--mat-app-surface-container-low));border-color:var(--mdc-elevated-card-container-color, var(--mat-app-surface-container-low));border-radius:var(--mdc-elevated-card-container-shape, var(--mat-app-corner-medium));box-shadow:var(--mdc-elevated-card-container-elevation, var(--mat-app-level1))}.mat-mdc-card::after{position:absolute;top:0;left:0;width:100%;height:100%;border:solid 1px rgba(0,0,0,0);content:"";display:block;pointer-events:none;box-sizing:border-box;border-radius:var(--mdc-elevated-card-container-shape, var(--mat-app-corner-medium))}.mat-mdc-card-outlined{background-color:var(--mdc-outlined-card-container-color, var(--mat-app-surface));border-radius:var(--mdc-outlined-card-container-shape, var(--mat-app-corner-medium));border-width:var(--mdc-outlined-card-outline-width);border-color:var(--mdc-outlined-card-outline-color, var(--mat-app-outline-variant));box-shadow:var(--mdc-outlined-card-container-elevation, var(--mat-app-level0))}.mat-mdc-card-outlined::after{border:none}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mat-mdc-card-actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font, var(--mat-app-title-large-font));line-height:var(--mat-card-title-text-line-height, var(--mat-app-title-large-line-height));font-size:var(--mat-card-title-text-size, var(--mat-app-title-large-size));letter-spacing:var(--mat-card-title-text-tracking, var(--mat-app-title-large-tracking));font-weight:var(--mat-card-title-text-weight, var(--mat-app-title-large-weight))}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color, var(--mat-app-on-surface));font-family:var(--mat-card-subtitle-text-font, var(--mat-app-title-medium-font));line-height:var(--mat-card-subtitle-text-line-height, var(--mat-app-title-medium-line-height));font-size:var(--mat-card-subtitle-text-size, var(--mat-app-title-medium-size));letter-spacing:var(--mat-card-subtitle-text-tracking, var(--mat-app-title-medium-tracking));font-weight:var(--mat-card-subtitle-text-weight, var(--mat-app-title-medium-weight))}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}'],encapsulation:2,changeDetection:0})}}return n})(),F=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275dir=e.FsC({type:n,selectors:[["mat-card-title"],["","mat-card-title",""],["","matCardTitle",""]],hostAttrs:[1,"mat-mdc-card-title"],standalone:!0})}}return n})(),A=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275dir=e.FsC({type:n,selectors:[["mat-card-content"]],hostAttrs:[1,"mat-mdc-card-content"],standalone:!0})}}return n})(),H=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({imports:[u.yE,O.CommonModule,u.yE]})}}return n})();var C=l(7110),j=l(9631),y=l(6969),K=l(4955),S=l(8464),Q=l(8203),D=(l(4402),l(7673),l(1413));class ee{get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}constructor(o=!1,t,a=!0,i){this._multiple=o,this._emitChanges=a,this.compareWith=i,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new D.B,t&&t.length&&(o?t.forEach(r=>this._markSelected(r)):this._markSelected(t[0]),this._selectedToEmit.length=0)}select(...o){this._verifyValueAssignment(o),o.forEach(a=>this._markSelected(a));const t=this._hasQueuedChanges();return this._emitChangeEvent(),t}deselect(...o){this._verifyValueAssignment(o),o.forEach(a=>this._unmarkSelected(a));const t=this._hasQueuedChanges();return this._emitChangeEvent(),t}setSelection(...o){this._verifyValueAssignment(o);const t=this.selected,a=new Set(o);o.forEach(r=>this._markSelected(r)),t.filter(r=>!a.has(this._getConcreteValue(r,a))).forEach(r=>this._unmarkSelected(r));const i=this._hasQueuedChanges();return this._emitChangeEvent(),i}toggle(o){return this.isSelected(o)?this.deselect(o):this.select(o)}clear(o=!0){this._unmarkAll();const t=this._hasQueuedChanges();return o&&this._emitChangeEvent(),t}isSelected(o){return this._selection.has(this._getConcreteValue(o))}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(o){this._multiple&&this.selected&&this._selected.sort(o)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(o){o=this._getConcreteValue(o),this.isSelected(o)||(this._multiple||this._unmarkAll(),this.isSelected(o)||this._selection.add(o),this._emitChanges&&this._selectedToEmit.push(o))}_unmarkSelected(o){o=this._getConcreteValue(o),this.isSelected(o)&&(this._selection.delete(o),this._emitChanges&&this._deselectedToEmit.push(o))}_unmarkAll(){this.isEmpty()||this._selection.forEach(o=>this._unmarkSelected(o))}_verifyValueAssignment(o){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}_getConcreteValue(o,t){if(this.compareWith){t=t??this._selection;for(let a of t)if(this.compareWith(o,a))return a;return o}return o}}var m=l(7336),_=l(9417),te=l(9030),x=l(7786),B=l(9172),R=l(5558),V=l(5964),P=l(6354),ae=l(3294),M=l(6977),ie=l(6697),h=l(9969);const ne=["trigger"],re=["panel"],oe=[[["mat-select-trigger"]],"*"],se=["mat-select-trigger","*"];function le(n,o){if(1&n&&(e.j41(0,"span",4),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.placeholder)}}function ce(n,o){1&n&&e.SdG(0)}function de(n,o){if(1&n&&(e.j41(0,"span",11),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.JRh(t.triggerValue)}}function me(n,o){if(1&n&&(e.j41(0,"span",5),e.DNE(1,ce,1,0)(2,de,2,1,"span",11),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.vxM(t.customTrigger?1:2)}}function he(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",12,1),e.bIt("@transformPanel.done",function(i){e.eBV(t);const r=e.XpG();return e.Njj(r._panelDoneAnimatingStream.next(i.toState))})("keydown",function(i){e.eBV(t);const r=e.XpG();return e.Njj(r._handleKeydown(i))}),e.SdG(2,1),e.k0s()}if(2&n){const t=e.XpG();e.ZvI("mat-mdc-select-panel mdc-menu-surface mdc-menu-surface--open ",t._getPanelTheme(),""),e.Y8G("ngClass",t.panelClass)("@transformPanel","showing"),e.BMQ("id",t.id+"-panel")("aria-multiselectable",t.multiple)("aria-label",t.ariaLabel||null)("aria-labelledby",t._getPanelAriaLabelledby())}}const pe={transformPanelWrap:(0,h.hZ)("transformPanelWrap",[(0,h.kY)("* => void",(0,h.P)("@transformPanel",[(0,h.MA)()],{optional:!0}))]),transformPanel:(0,h.hZ)("transformPanel",[(0,h.wk)("void",(0,h.iF)({opacity:0,transform:"scale(1, 0.8)"})),(0,h.kY)("void => showing",(0,h.i0)("120ms cubic-bezier(0, 0, 0.2, 1)",(0,h.iF)({opacity:1,transform:"scale(1, 1)"}))),(0,h.kY)("* => void",(0,h.i0)("100ms linear",(0,h.iF)({opacity:0})))])};let G=0;const L=new e.nKC("mat-select-scroll-strategy",{providedIn:"root",factory:()=>{const n=(0,e.WQX)(y.hJ);return()=>n.scrollStrategies.reposition()}}),ge=new e.nKC("MAT_SELECT_CONFIG"),fe=new e.nKC("MatSelectTrigger");class _e{constructor(o,t){this.source=o,this.value=t}}let be=(()=>{class n{_scrollOptionIntoView(t){const a=this.options.toArray()[t];if(a){const i=this.panel.nativeElement,r=(0,u.jb)(t,this.options,this.optionGroups),s=a._getHostElement();i.scrollTop=0===t&&1===r?0:(0,u.TL)(s.offsetTop,s.offsetHeight,i.scrollTop,i.offsetHeight)}}_positioningSettled(){this._scrollOptionIntoView(this._keyManager.activeItemIndex||0)}_getChangeEvent(t){return new _e(this,t)}get focused(){return this._focused||this._panelOpen}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(t){this._hideSingleSelectionIndicator=t,this._syncParentProperties()}get placeholder(){return this._placeholder}set placeholder(t){this._placeholder=t,this.stateChanges.next()}get required(){return this._required??this.ngControl?.control?.hasValidator(_.k0.required)??!1}set required(t){this._required=t,this.stateChanges.next()}get multiple(){return this._multiple}set multiple(t){this._multiple=t}get compareWith(){return this._compareWith}set compareWith(t){this._compareWith=t,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(t){this._assignValue(t)&&this._onChange(t)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(t){this._errorStateTracker.matcher=t}get id(){return this._id}set id(t){this._id=t||this._uid,this.stateChanges.next()}get errorState(){return this._errorStateTracker.errorState}set errorState(t){this._errorStateTracker.errorState=t}constructor(t,a,i,r,s,d,c,g,f,v,Be,Re,Ve,E){this._viewportRuler=t,this._changeDetectorRef=a,this._elementRef=s,this._dir=d,this._parentFormField=f,this.ngControl=v,this._liveAnnouncer=Ve,this._defaultOptions=E,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"}],this._panelOpen=!1,this._compareWith=(p,w)=>p===w,this._uid="mat-select-"+G++,this._triggerAriaLabelledBy=null,this._destroy=new D.B,this.stateChanges=new D.B,this.disableAutomaticLabeling=!0,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="mat-select-value-"+G++,this._panelDoneAnimatingStream=new D.B,this._overlayPanelClass=this._defaultOptions?.overlayPanelClass||"",this._focused=!1,this.controlType="mat-select",this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this._hideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1,this._multiple=!1,this.disableOptionCentering=this._defaultOptions?.disableOptionCentering??!1,this.ariaLabel="",this.panelWidth=this._defaultOptions&&typeof this._defaultOptions.panelWidth<"u"?this._defaultOptions.panelWidth:"auto",this._initialized=new D.B,this.optionSelectionChanges=(0,te.v)(()=>{const p=this.options;return p?p.changes.pipe((0,B.Z)(p),(0,R.n)(()=>(0,x.h)(...p.map(w=>w.onSelectionChange)))):this._initialized.pipe((0,R.n)(()=>this.optionSelectionChanges))}),this.openedChange=new e.bkB,this._openedStream=this.openedChange.pipe((0,V.p)(p=>p),(0,P.T)(()=>{})),this._closedStream=this.openedChange.pipe((0,V.p)(p=>!p),(0,P.T)(()=>{})),this.selectionChange=new e.bkB,this.valueChange=new e.bkB,this._trackedModal=null,this._skipPredicate=p=>!this.panelOpen&&p.disabled,this.ngControl&&(this.ngControl.valueAccessor=this),null!=E?.typeaheadDebounceInterval&&(this.typeaheadDebounceInterval=E.typeaheadDebounceInterval),this._errorStateTracker=new u.X0(r,v,g,c,this.stateChanges),this._scrollStrategyFactory=Re,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(Be)||0,this.id=this.id}ngOnInit(){this._selectionModel=new ee(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe((0,ae.F)(),(0,M.Q)(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe((0,M.Q)(this._destroy)).subscribe(()=>{this.panelOpen&&(this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._changeDetectorRef.detectChanges())})}ngAfterContentInit(){this._initialized.next(),this._initialized.complete(),this._initKeyManager(),this._selectionModel.changed.pipe((0,M.Q)(this._destroy)).subscribe(t=>{t.added.forEach(a=>a.select()),t.removed.forEach(a=>a.deselect())}),this.options.changes.pipe((0,B.Z)(null),(0,M.Q)(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const t=this._getTriggerAriaLabelledby(),a=this.ngControl;if(t!==this._triggerAriaLabelledBy){const i=this._elementRef.nativeElement;this._triggerAriaLabelledBy=t,t?i.setAttribute("aria-labelledby",t):i.removeAttribute("aria-labelledby")}a&&(this._previousControl!==a.control&&(void 0!==this._previousControl&&null!==a.disabled&&a.disabled!==this.disabled&&(this.disabled=a.disabled),this._previousControl=a.control),this.updateErrorState())}ngOnChanges(t){(t.disabled||t.userAriaDescribedBy)&&this.stateChanges.next(),t.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this.typeaheadDebounceInterval)}ngOnDestroy(){this._keyManager?.destroy(),this._destroy.next(),this._destroy.complete(),this.stateChanges.complete(),this._clearFromModal()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._parentFormField&&(this._preferredOverlayOrigin=this._parentFormField.getConnectedOverlayOrigin()),this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._applyModalPanelOwnership(),this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_applyModalPanelOwnership(){const t=this._elementRef.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!t)return;const a=`${this.id}-panel`;this._trackedModal&&(0,S.Ae)(this._trackedModal,"aria-owns",a),(0,S.px)(t,"aria-owns",a),this._trackedModal=t}_clearFromModal(){this._trackedModal&&((0,S.Ae)(this._trackedModal,"aria-owns",`${this.id}-panel`),this._trackedModal=null)}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched(),this.stateChanges.next())}writeValue(t){this._assignValue(t)}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){return this.multiple?this._selectionModel?.selected||[]:this._selectionModel?.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){const t=this._selectionModel.selected.map(a=>a.viewValue);return this._isRtl()&&t.reverse(),t.join(", ")}return this._selectionModel.selected[0].viewValue}updateErrorState(){this._errorStateTracker.updateErrorState()}_isRtl(){return!!this._dir&&"rtl"===this._dir.value}_handleKeydown(t){this.disabled||(this.panelOpen?this._handleOpenKeydown(t):this._handleClosedKeydown(t))}_handleClosedKeydown(t){const a=t.keyCode,i=a===m.n6||a===m.i7||a===m.UQ||a===m.LE,r=a===m.Fm||a===m.t6,s=this._keyManager;if(!s.isTyping()&&r&&!(0,m.rp)(t)||(this.multiple||t.altKey)&&i)t.preventDefault(),this.open();else if(!this.multiple){const d=this.selected;s.onKeydown(t);const c=this.selected;c&&d!==c&&this._liveAnnouncer.announce(c.viewValue,1e4)}}_handleOpenKeydown(t){const a=this._keyManager,i=t.keyCode,r=i===m.n6||i===m.i7,s=a.isTyping();if(r&&t.altKey)t.preventDefault(),this.close();else if(s||i!==m.Fm&&i!==m.t6||!a.activeItem||(0,m.rp)(t))if(!s&&this._multiple&&i===m.A&&t.ctrlKey){t.preventDefault();const d=this.options.some(c=>!c.disabled&&!c.selected);this.options.forEach(c=>{c.disabled||(d?c.select():c.deselect())})}else{const d=a.activeItemIndex;a.onKeydown(t),this._multiple&&r&&t.shiftKey&&a.activeItem&&a.activeItemIndex!==d&&a.activeItem._selectViaInteraction()}else t.preventDefault(),a.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,this._keyManager?.cancelTypeahead(),!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this._overlayDir.positionChange.pipe((0,ie.s)(1)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this._positioningSettled()})}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(t){if(this.options.forEach(a=>a.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&t)Array.isArray(t),t.forEach(a=>this._selectOptionByValue(a)),this._sortValues();else{const a=this._selectOptionByValue(t);a?this._keyManager.updateActiveItem(a):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(t){const a=this.options.find(i=>{if(this._selectionModel.isSelected(i))return!1;try{return null!=i.value&&this._compareWith(i.value,t)}catch{return!1}});return a&&this._selectionModel.select(a),a}_assignValue(t){return!!(t!==this._value||this._multiple&&Array.isArray(t))&&(this.options&&this._setSelectionByValue(t),this._value=t,!0)}_getOverlayWidth(t){return"auto"===this.panelWidth?(t instanceof y.$Q?t.elementRef:t||this._elementRef).nativeElement.getBoundingClientRect().width:null===this.panelWidth?"":this.panelWidth}_syncParentProperties(){if(this.options)for(const t of this.options)t._changeDetectorRef.markForCheck()}_initKeyManager(){this._keyManager=new S.Au(this.options).withTypeAhead(this.typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr").withHomeAndEnd().withPageUpDown().withAllowedModifierKeys(["shiftKey"]).skipPredicate(this._skipPredicate),this._keyManager.tabOut.subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const t=(0,x.h)(this.options.changes,this._destroy);this.optionSelectionChanges.pipe((0,M.Q)(t)).subscribe(a=>{this._onSelect(a.source,a.isUserInput),a.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),(0,x.h)(...this.options.map(a=>a._stateChanges)).pipe((0,M.Q)(t)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this.stateChanges.next()})}_onSelect(t,a){const i=this._selectionModel.isSelected(t);null!=t.value||this._multiple?(i!==t.selected&&(t.selected?this._selectionModel.select(t):this._selectionModel.deselect(t)),a&&this._keyManager.setActiveItem(t),this.multiple&&(this._sortValues(),a&&this.focus())):(t.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(t.value)),i!==this._selectionModel.isSelected(t)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const t=this.options.toArray();this._selectionModel.sort((a,i)=>this.sortComparator?this.sortComparator(a,i,t):t.indexOf(a)-t.indexOf(i)),this.stateChanges.next()}}_propagateChanges(t){let a;a=this.multiple?this.selected.map(i=>i.value):this.selected?this.selected.value:t,this._value=a,this.valueChange.emit(a),this._onChange(a),this.selectionChange.emit(this._getChangeEvent(a)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){if(this._keyManager)if(this.empty){let t=-1;for(let a=0;a<this.options.length;a++)if(!this.options.get(a).disabled){t=a;break}this._keyManager.setActiveItem(t)}else this._keyManager.setActiveItem(this._selectionModel.selected[0])}_canOpen(){return!this._panelOpen&&!this.disabled&&this.options?.length>0}focus(t){this._elementRef.nativeElement.focus(t)}_getPanelAriaLabelledby(){if(this.ariaLabel)return null;const t=this._parentFormField?.getLabelId();return this.ariaLabelledby?(t?t+" ":"")+this.ariaLabelledby:t}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){if(this.ariaLabel)return null;const t=this._parentFormField?.getLabelId();let a=(t?t+" ":"")+this._valueId;return this.ariaLabelledby&&(a+=" "+this.ariaLabelledby),a}_panelDoneAnimating(t){this.openedChange.emit(t)}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this.panelOpen||!this.empty||this.focused&&!!this.placeholder}static{this.\u0275fac=function(a){return new(a||n)(e.rXU(K.Xj),e.rXU(e.gRc),e.rXU(e.SKi),e.rXU(u.es),e.rXU(e.aKT),e.rXU(Q.dS,8),e.rXU(_.cV,8),e.rXU(_.j4,8),e.rXU(C.xb,8),e.rXU(_.vO,10),e.kS0("tabindex"),e.rXU(L),e.rXU(S.Ai),e.rXU(ge,8))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["mat-select"]],contentQueries:function(a,i,r){if(1&a&&(e.wni(r,fe,5),e.wni(r,u.wT,5),e.wni(r,u.QC,5)),2&a){let s;e.mGM(s=e.lsd())&&(i.customTrigger=s.first),e.mGM(s=e.lsd())&&(i.options=s),e.mGM(s=e.lsd())&&(i.optionGroups=s)}},viewQuery:function(a,i){if(1&a&&(e.GBs(ne,5),e.GBs(re,5),e.GBs(y.WB,5)),2&a){let r;e.mGM(r=e.lsd())&&(i.trigger=r.first),e.mGM(r=e.lsd())&&(i.panel=r.first),e.mGM(r=e.lsd())&&(i._overlayDir=r.first)}},hostAttrs:["role","combobox","aria-haspopup","listbox",1,"mat-mdc-select"],hostVars:19,hostBindings:function(a,i){1&a&&e.bIt("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&a&&(e.BMQ("id",i.id)("tabindex",i.disabled?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),e.AVh("mat-mdc-select-disabled",i.disabled)("mat-mdc-select-invalid",i.errorState)("mat-mdc-select-required",i.required)("mat-mdc-select-empty",i.empty)("mat-mdc-select-multiple",i.multiple))},inputs:{userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",disabled:[2,"disabled","disabled",e.L39],disableRipple:[2,"disableRipple","disableRipple",e.L39],tabIndex:[2,"tabIndex","tabIndex",t=>null==t?0:(0,e.Udg)(t)],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",e.L39],placeholder:"placeholder",required:[2,"required","required",e.L39],multiple:[2,"multiple","multiple",e.L39],disableOptionCentering:[2,"disableOptionCentering","disableOptionCentering",e.L39],compareWith:"compareWith",value:"value",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:[2,"typeaheadDebounceInterval","typeaheadDebounceInterval",e.Udg],sortComparator:"sortComparator",id:"id",panelWidth:"panelWidth"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["matSelect"],standalone:!0,features:[e.Jv_([{provide:C.qT,useExisting:n},{provide:u.is,useExisting:n}]),e.GFd,e.OA$,e.aNF],ngContentSelectors:se,decls:11,vars:8,consts:[["fallbackOverlayOrigin","cdkOverlayOrigin","trigger",""],["panel",""],["cdk-overlay-origin","",1,"mat-mdc-select-trigger",3,"click"],[1,"mat-mdc-select-value"],[1,"mat-mdc-select-placeholder","mat-mdc-select-min-line"],[1,"mat-mdc-select-value-text"],[1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],["viewBox","0 0 24 24","width","24px","height","24px","focusable","false","aria-hidden","true"],["d","M7 10l5 5 5-5z"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"backdropClick","attach","detach","cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth"],[1,"mat-mdc-select-min-line"],["role","listbox","tabindex","-1",3,"keydown","ngClass"]],template:function(a,i){if(1&a){const r=e.RV6();e.NAR(oe),e.j41(0,"div",2,0),e.bIt("click",function(){return e.eBV(r),e.Njj(i.open())}),e.j41(3,"div",3),e.DNE(4,le,2,1,"span",4)(5,me,3,1,"span",5),e.k0s(),e.j41(6,"div",6)(7,"div",7),e.qSk(),e.j41(8,"svg",8),e.nrm(9,"path",9),e.k0s()()()(),e.DNE(10,he,3,9,"ng-template",10),e.bIt("backdropClick",function(){return e.eBV(r),e.Njj(i.close())})("attach",function(){return e.eBV(r),e.Njj(i._onAttached())})("detach",function(){return e.eBV(r),e.Njj(i.close())})}if(2&a){const r=e.sdS(1);e.R7$(3),e.BMQ("id",i._valueId),e.R7$(),e.vxM(i.empty?4:5),e.R7$(6),e.Y8G("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._preferredOverlayOrigin||r)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",i._overlayWidth)}},dependencies:[y.$Q,y.WB,O.NgClass],styles:['.mat-mdc-select{display:inline-block;width:100%;outline:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-select-enabled-trigger-text-color, var(--mat-app-on-surface));font-family:var(--mat-select-trigger-text-font, var(--mat-app-body-large-font));line-height:var(--mat-select-trigger-text-line-height, var(--mat-app-body-large-line-height));font-size:var(--mat-select-trigger-text-size, var(--mat-app-body-large-size));font-weight:var(--mat-select-trigger-text-weight, var(--mat-app-body-large-weight));letter-spacing:var(--mat-select-trigger-text-tracking, var(--mat-app-body-large-tracking))}div.mat-mdc-select-panel{box-shadow:var(--mat-select-container-elevation-shadow)}.mat-mdc-select-disabled{color:var(--mat-select-disabled-trigger-text-color)}.mat-mdc-select-trigger{display:inline-flex;align-items:center;cursor:pointer;position:relative;box-sizing:border-box;width:100%}.mat-mdc-select-disabled .mat-mdc-select-trigger{-webkit-user-select:none;user-select:none;cursor:default}.mat-mdc-select-value{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-mdc-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-mdc-select-arrow-wrapper{height:24px;flex-shrink:0;display:inline-flex;align-items:center}.mat-form-field-appearance-fill .mdc-text-field--no-label .mat-mdc-select-arrow-wrapper{transform:none}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-invalid .mat-mdc-select-arrow,.mat-form-field-invalid:not(.mat-form-field-disabled) .mat-mdc-form-field-infix::after{color:var(--mat-select-invalid-arrow-color, var(--mat-app-error))}.mat-mdc-select-arrow{width:10px;height:5px;position:relative;color:var(--mat-select-enabled-arrow-color, var(--mat-app-on-surface-variant))}.mat-mdc-form-field.mat-focused .mat-mdc-select-arrow{color:var(--mat-select-focused-arrow-color, var(--mat-app-primary))}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-disabled .mat-mdc-select-arrow{color:var(--mat-select-disabled-arrow-color)}.mat-mdc-select-arrow svg{fill:currentColor;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:CanvasText}.mat-mdc-select-disabled .cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:GrayText}div.mat-mdc-select-panel{width:100%;max-height:275px;outline:0;overflow:auto;padding:8px 0;border-radius:4px;box-sizing:border-box;position:static;background-color:var(--mat-select-panel-background-color, var(--mat-app-surface-container))}.cdk-high-contrast-active div.mat-mdc-select-panel{outline:solid 1px}.cdk-overlay-pane:not(.mat-mdc-select-panel-above) div.mat-mdc-select-panel{border-top-left-radius:0;border-top-right-radius:0;transform-origin:top center}.mat-mdc-select-panel-above div.mat-mdc-select-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:bottom center}div.mat-mdc-select-panel .mat-mdc-option{--mdc-list-list-item-container-color: var(--mat-select-panel-background-color)}.mat-mdc-select-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1);color:var(--mat-select-placeholder-text-color, var(--mat-app-on-surface-variant))}._mat-animation-noopable .mat-mdc-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-mdc-select-placeholder{color:rgba(0,0,0,0);-webkit-text-fill-color:rgba(0,0,0,0);transition:none;display:block}.mat-mdc-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper{cursor:pointer}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mat-mdc-floating-label{max-width:calc(100% - 18px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 24px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-text-field--label-floating .mdc-notched-outline__notch{max-width:calc(100% - 24px)}.mat-mdc-select-min-line:empty::before{content:" ";white-space:pre;width:1px;display:inline-block;visibility:hidden}.mat-form-field-appearance-fill .mat-mdc-select-arrow-wrapper{transform:var(--mat-select-arrow-transform)}'],encapsulation:2,data:{animation:[pe.transformPanel]},changeDetection:0})}}return n})();var ve=l(6218);const Ce=["calendarEl"],ye=["calendar"],Me=(n,o)=>o.id,ke=(n,o)=>o.value;function Se(n,o){if(1&n){const t=e.RV6();e.j41(0,"h3"),e.EFF(1,"Gestiona el uso de libro"),e.k0s(),e.j41(2,"div",14)(3,"div",15),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.seleccionarOpcion("alquiler"))}),e.j41(4,"div",16)(5,"h4"),e.EFF(6,"Alquilar libro"),e.k0s(),e.nrm(7,"input",17),e.k0s(),e.j41(8,"div",18),e.nrm(9,"img",19),e.k0s(),e.j41(10,"p",20),e.EFF(11,"Acceso ilimitado durante periodo de alquiler"),e.k0s()(),e.j41(12,"div",21),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.seleccionarOpcion("club"))}),e.j41(13,"div",16)(14,"h4"),e.EFF(15,"Crear club de lectura"),e.k0s(),e.nrm(16,"input",17),e.k0s(),e.j41(17,"div",18),e.nrm(18,"img",22),e.k0s(),e.j41(19,"p",20),e.EFF(20,"Organiza tu propio club de lectura"),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(7),e.Y8G("checked","alquiler"===t.selectedOption),e.R7$(9),e.Y8G("checked","club"===t.selectedOption)}}function De(n,o){if(1&n){const t=e.RV6();e.j41(0,"h4"),e.EFF(1,"Has seleccionado alquilar el libro \u{1f4da}"),e.k0s(),e.j41(2,"div",24)(3,"mat-form-field",25)(4,"mat-label"),e.EFF(5,"Fecha de inicio"),e.k0s(),e.j41(6,"input",26),e.mxI("ngModelChange",function(i){e.eBV(t);const r=e.XpG(2);return e.DH7(r.selectedStartDate,i)||(r.selectedStartDate=i),e.Njj(i)}),e.bIt("dateChange",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.validateEndDate())}),e.k0s(),e.nrm(7,"mat-datepicker-toggle",27)(8,"mat-datepicker",null,0),e.k0s(),e.j41(10,"mat-form-field",25)(11,"mat-label"),e.EFF(12,"Fecha de fin"),e.k0s(),e.j41(13,"input",28),e.mxI("ngModelChange",function(i){e.eBV(t);const r=e.XpG(2);return e.DH7(r.selectedEndDate,i)||(r.selectedEndDate=i),e.Njj(i)}),e.k0s(),e.nrm(14,"mat-datepicker-toggle",27)(15,"mat-datepicker",null,1),e.k0s()(),e.j41(17,"button",29),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.reserveBook())}),e.EFF(18,"Alquilar libro"),e.k0s()}if(2&n){const t=e.sdS(9),a=e.sdS(16),i=e.XpG(2);e.R7$(6),e.Y8G("matDatepicker",t),e.R50("ngModel",i.selectedStartDate),e.Y8G("matDatepickerFilter",i.isDateUnavailable),e.R7$(),e.Y8G("for",t),e.R7$(6),e.Y8G("matDatepicker",a),e.R50("ngModel",i.selectedEndDate),e.Y8G("min",i.selectedStartDate)("matDatepickerFilter",i.isDateUnavailable),e.R7$(),e.Y8G("for",a)}}function Oe(n,o){if(1&n){const t=e.RV6();e.j41(0,"mat-card",39),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(4);return e.Njj(r.seleccionarSala(i))}),e.j41(1,"mat-card-title"),e.EFF(2),e.k0s(),e.j41(3,"mat-card-content"),e.EFF(4),e.k0s()()}if(2&n){const t=o.$implicit,a=e.XpG(4);e.AVh("selected",(null==a.salaSeleccionada?null:a.salaSeleccionada.id)===t.id),e.R7$(2),e.JRh(t.nombre),e.R7$(2),e.SpI("Capacidad: ",t.capacidad,"")}}function xe(n,o){if(1&n&&(e.j41(0,"div",32),e.Z7z(1,Oe,5,4,"mat-card",38,Me),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.Dyx(t.salasDisponibles)}}function Ee(n,o){1&n&&(e.j41(0,"p",33),e.EFF(1,"\u274c No quedan salas con franjas libres ese d\xeda."),e.k0s())}function we(n,o){if(1&n&&(e.j41(0,"mat-option",41),e.EFF(1),e.k0s()),2&n){const t=o.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(t.label)}}function Te(n,o){if(1&n){const t=e.RV6();e.j41(0,"mat-form-field",35)(1,"mat-label"),e.EFF(2,"Seleccionar franja horaria"),e.k0s(),e.j41(3,"mat-select",40),e.mxI("valueChange",function(i){e.eBV(t);const r=e.XpG(3);return e.DH7(r.franjaSeleccionada,i)||(r.franjaSeleccionada=i),e.Njj(i)}),e.Z7z(4,we,2,2,"mat-option",41,ke),e.k0s()()}if(2&n){const t=e.XpG(3);e.R7$(3),e.R50("value",t.franjaSeleccionada),e.R7$(),e.Dyx(t.getFranjasDisponiblesParaSala(t.salaSeleccionada?t.salaSeleccionada.id:""))}}function Ie(n,o){1&n&&(e.j41(0,"p",33),e.EFF(1,"\u274c Esta sala no tiene franjas disponibles ese d\xeda."),e.k0s())}function Fe(n,o){if(1&n){const t=e.RV6();e.j41(0,"h4"),e.EFF(1,"Vas a crear un club de lectura \u{1f465}"),e.k0s(),e.j41(2,"mat-card",30,2)(4,"mat-calendar",31,3),e.mxI("selectedChange",function(i){e.eBV(t);const r=e.XpG(2);return e.DH7(r.selected,i)||(r.selected=i),e.Njj(i)}),e.bIt("selectedChange",function(i){e.eBV(t);const r=e.XpG(2);return e.Njj(r.getSalaDisponible(i))}),e.k0s()(),e.DNE(6,xe,3,0,"div",32)(7,Ee,2,0,"p",33),e.j41(8,"div",34),e.DNE(9,Te,6,1,"mat-form-field",35)(10,Ie,2,0,"p",33),e.k0s(),e.j41(11,"mat-form-field",36)(12,"mat-label"),e.EFF(13,"Observaciones"),e.k0s(),e.j41(14,"textarea",37),e.mxI("ngModelChange",function(i){e.eBV(t);const r=e.XpG(2);return e.DH7(r.observaciones,i)||(r.observaciones=i),e.Njj(i)}),e.k0s()(),e.j41(15,"button",29),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.crearClub())}),e.EFF(16,"Crear club de lectura"),e.k0s()}if(2&n){const t=e.XpG(2);e.R7$(4),e.R50("selected",t.selected),e.Y8G("dateFilter",t.dateFilterClub),e.R7$(2),e.vxM(t.salasDisponibles.length>0?6:7),e.R7$(3),e.vxM(t.getFranjasDisponiblesParaSala(t.salaSeleccionada?t.salaSeleccionada.id:"").length>0?9:10),e.R7$(5),e.R50("ngModel",t.observaciones)}}function Ae(n,o){if(1&n){const t=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.resetOpcion())}),e.EFF(1,"\u2b05 Volver"),e.k0s(),e.DNE(2,De,19,9)(3,Fe,17,5)}if(2&n){const t=e.XpG();e.R7$(2),e.vxM("alquiler"===t.selectedOption?2:"club"===t.selectedOption?3:-1)}}let je=(()=>{class n{apiService;renderer;cdr;book=null;readOnly=!1;close=new e.bkB;calendarEl;calendar;selected=(0,e.geq)(new Date);selectedStartDate=null;selectedEndDate=null;unavailableDates=new Set;fechasOcupadasClub=new Set;salasOcupadasMes={};selectedOption=null;salasExistentes=[];salasDisponibles=[];salaSeleccionada=null;franjasVisibles=[{label:"09:00 \u2013 11:00",value:"MANANA"},{label:"11:00 \u2013 13:00",value:"MEDIA_MANANA"},{label:"13:00 \u2013 15:00",value:"MEDIO_DIA"},{label:"15:00 \u2013 17:00",value:"TARDE"},{label:"17:00 \u2013 20:00",value:"TARDE_NOCHE"}];franjasOcupadasPorSala={};franjaSeleccionada=null;observaciones=null;constructor(t,a,i){this.apiService=t,this.renderer=a,this.cdr=i}ngAfterViewInit(){setTimeout(()=>this.onMonthViewChanged(),0),setTimeout(()=>this.getSalaDisponible(this.selected()),0)}ngOnInit(){if(!this.book)return;this.loadSalas(),this.apiService.getBookReservations(this.book.id).subscribe({next:i=>this.processUnavailableDates(i),error:i=>console.error("Error reservas alquiler:",i)});const t=new Date,a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-10`;this.loadDiasNoDisponibles(a)}processUnavailableDates(t){this.unavailableDates.clear(),t.forEach(a=>{const i=this.arrayToDate(a.fechaRecogida),r=this.arrayToDate(a.fechaDevolucion);this.markDatesUnavailable(i,r)})}arrayToDate(t){return new Date(t[0],t[1]-1,t[2])}markDatesUnavailable(t,a){const i=new Date(t);for(;i<=a;)this.unavailableDates.add(i.toISOString().split("T")[0]),i.setDate(i.getDate()+1)}isDateUnavailable=t=>{if(!t)return!1;const a=t.toISOString().split("T")[0],i=new Date;return i.setHours(0,0,0,0),t>=i&&!this.unavailableDates.has(a)};validateEndDate(){this.selectedEndDate&&this.selectedStartDate&&this.selectedEndDate<this.selectedStartDate&&(this.selectedEndDate=this.selectedStartDate)}loadSalasOcupadasMes(t){this.apiService.getSalasOcupadasMes(t).subscribe({next:a=>{this.salasOcupadasMes=a},error:a=>console.error("Error cargando salas ocupadas del mes:",a)})}loadDiasNoDisponibles(t){this.apiService.getDisponibilidadLibroMes(this.book.id,t).subscribe({next:a=>this.processFechasOcupadas(a),error:a=>console.error("Error disponibilidad libro:",a)})}processFechasOcupadas(t){this.fechasOcupadasClub=new Set(t.map(([a,i,r])=>new Date(a,i-1,r).toISOString().split("T")[0])),this.calendar&&this.calendar.updateTodaysDate()}dateFilterClub=t=>{if(!t)return!1;const a=this.toLocalISO(t);return!(a<this.toLocalISO(new Date)||this.fechasOcupadasClub.has(a))};onMonthViewChanged(){const t=this.calendar.activeDate,a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-10`;this.loadDiasNoDisponibles(a),this.loadSalasOcupadasMes(a)}seleccionarOpcion(t){this.selectedOption=t,setTimeout(()=>{"club"===t&&[this.calendarEl.nativeElement.querySelector("button.mat-calendar-previous-button"),this.calendarEl.nativeElement.querySelector("button.mat-calendar-next-button")].forEach(r=>{r&&this.renderer.listen(r,"click",()=>{setTimeout(()=>this.onMonthViewChanged(),1e3)})})},0)}resetOpcion(){this.selectedOption=null}getSalaDisponible(t){if(!t)return;const a=this.toLocalISO(t),i=this.salasOcupadasMes[a];i?this.mapearOcupacionADisponibles(i):this.apiService.getSalasOcupadas(a).subscribe(r=>{const s={};r.forEach(d=>s[d.salaId]=d),this.mapearOcupacionADisponibles(s)})}mapearOcupacionADisponibles(t){this.franjasOcupadasPorSala={},this.salasDisponibles=[];let a=[];Object.values(t).forEach(i=>{let r=i.clubesLectura.filter(s=>s.libro?.id==this.book.id);void 0!==r&&r.length>0&&a.push(...r.map(s=>s.franjaHoraria))}),Object.entries(t).forEach(([i,r])=>{this.franjasOcupadasPorSala[i]=r.clubesLectura.map(s=>s.franjaHoraria)}),a.length>0&&this.salasExistentes.forEach(i=>{Object.keys(this.franjasOcupadasPorSala).includes(i.id)||(this.franjasOcupadasPorSala[i.id]=[]),this.franjasOcupadasPorSala[i.id].push(...a)}),this.salasDisponibles=this.salasExistentes.filter(i=>(this.franjasOcupadasPorSala[i.id]??[]).length<this.franjasVisibles.length),0===Object.keys(t).length&&(this.salasDisponibles=[...this.salasExistentes])}getFranjasDisponiblesParaSala(t){const a=this.franjasOcupadasPorSala[t]??[];return this.franjasVisibles.filter(i=>!a.includes(i.value))}seleccionarSala(t){this.salaSeleccionada=t,this.franjaSeleccionada=null}crearClub(){const t=localStorage.getItem("userId");if(!(t&&this.selected()&&this.salaSeleccionada&&this.franjaSeleccionada))return void alert("Falta alg\xfan dato para crear el club.");const a=this.selected();a.setHours(12,0,0,0);const i=a.toISOString();this.apiService.crearClub(this.book.id,t,i,i,this.salaSeleccionada.id,this.observaciones??"",this.franjaSeleccionada).subscribe({next:()=>{alert("Club creado con \xe9xito."),this.close.emit()},error:r=>{console.error("Error creando club:",r),setTimeout(()=>{alert(`Error: ${r.error?.message||"Erros creando club."}`)},100)}})}reserveBook(){const t=localStorage.getItem("userId");if(!t||!this.selectedStartDate||!this.selectedEndDate)return void alert("Selecciona fecha de inicio y de fin.");const a=this.toISODateTime(this.selectedStartDate,"00:00:00"),i=this.toISODateTime(this.selectedEndDate,"23:59:59");this.apiService.alquilarLibro(this.book.id,t,a,i).subscribe({next:()=>{alert("Reserva realizada con \xe9xito."),this.close.emit()},error:r=>{console.error("Error al reservar:",r),setTimeout(()=>{alert(`Error: ${r.error?.message||"Error al reservar."}`)},100)}})}toISODateTime(t,a){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}T${a}`}loadSalas(){this.apiService.getTodasSalas().subscribe({next:t=>this.salasExistentes=t,error:t=>console.error("Error cargando salas:",t)})}toLocalISO(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}cerrar(t){this.close.emit()}useABEBooksCover(t,a){const i=t.target;if(i.errorHandled)return;i.errorHandled=!0;const r=a.replaceAll("-","").slice(0,15);i.src=`https://pictures.abebooks.com/isbn/${r}-es.jpg`,i.onerror=s=>{s instanceof Event&&this.useOLBooksCover(s,a)}}useOLBooksCover(t,a){const i=t.target;i.src=`https://covers.openlibrary.org/b/isbn/${a}-L.jpg`,i.onload=()=>{(i.naturalWidth<50||i.naturalHeight<50)&&this.useLocalImage(i)},i.onerror=r=>{r instanceof Event&&this.useGoogleFallback(r,a)}}useGoogleFallback(t,a){const i=t.target,r=a.replaceAll("-","");i.src=`http://books.google.com/books/content?vid=ISBN${r}&printsec=frontcover&img=1&zoom=1`,i.onerror=s=>{this.useLocalImage(i)}}useLocalImage(t){t.src="assets/libro.png",t.onerror=null,t.classList.add("local-cover")}checkImageSize(t,a){const i=t.target;(i.naturalWidth<50||i.naturalHeight<50)&&this.useLocalImage(i),this.cdr.detectChanges()}static \u0275fac=function(a){return new(a||n)(e.rXU(ve.y),e.rXU(e.sFG),e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:n,selectors:[["app-book-modal"]],viewQuery:function(a,i){if(1&a&&(e.GBs(Ce,5,e.aKT),e.GBs(ye,5)),2&a){let r;e.mGM(r=e.lsd())&&(i.calendarEl=r.first),e.mGM(r=e.lsd())&&(i.calendar=r.first)}},inputs:{book:"book",readOnly:"readOnly",selected:[1,"selected"]},outputs:{close:"close",selected:"selectedChange"},standalone:!0,features:[e.aNF],decls:18,vars:9,consts:[["pickerStart",""],["pickerEnd",""],["calendarEl",""],["calendar","matCalendar"],[1,"modal",3,"click"],[1,"modal-content",3,"click"],[1,"close-btn",3,"click"],[1,"material-icons"],[1,"modal-body"],[1,"libro"],[1,"book-author"],[1,"book-anio"],[1,"book-cover",3,"error","load","src","alt"],[1,"reserva"],[1,"seleccion"],[1,"alquiler",3,"click"],[1,"header-radio"],["name","plan","type","radio",1,"radio",3,"checked"],[1,"img-contenedor"],["src","assets/leerLibro.jpg"],[1,"parafoDescrip"],[1,"club",3,"click"],["src","assets/clubl.png"],[1,"back-btn",3,"click"],[1,"date-fields"],["appearance","outline"],["matInput","",3,"ngModelChange","dateChange","matDatepicker","ngModel","matDatepickerFilter"],["matSuffix","",3,"for"],["matInput","",3,"ngModelChange","matDatepicker","ngModel","min","matDatepickerFilter"],[1,"estilo-btn",3,"click"],[1,"demo-inline-calendar-card"],[3,"selectedChange","selected","dateFilter"],[1,"salas"],[2,"color","red"],[2,"margin-top","2rem"],["appearance","fill",2,"width","100%"],["appearance","fill",2,"width","100%","margin-top","16px"],["matInput","","placeholder","A\xf1adir observaciones (opcional)",3,"ngModelChange","ngModel"],[2,"cursor","pointer","transition","transform 0.2s","width","max-content","padding","0.5rem",3,"selected"],[2,"cursor","pointer","transition","transform 0.2s","width","max-content","padding","0.5rem",3,"click"],[3,"valueChange","value"],[3,"value"]],template:function(a,i){1&a&&(e.j41(0,"div",4),e.bIt("click",function(s){return i.cerrar(s)}),e.j41(1,"div",5),e.bIt("click",function(s){return s.stopPropagation()}),e.j41(2,"button",6),e.bIt("click",function(){return i.close.emit()}),e.j41(3,"span",7),e.EFF(4,"close"),e.k0s()(),e.j41(5,"h3"),e.EFF(6),e.k0s(),e.j41(7,"div",8)(8,"div",9)(9,"p",10),e.EFF(10),e.nI1(11,"uppercase"),e.k0s(),e.j41(12,"p",11),e.EFF(13),e.k0s(),e.j41(14,"img",12),e.bIt("error",function(s){return i.useABEBooksCover(s,i.book.isbn)})("load",function(s){return i.checkImageSize(s,i.book)}),e.k0s()(),e.j41(15,"div",13),e.DNE(16,Se,21,2)(17,Ae,4,1),e.k0s()()()()),2&a&&(e.R7$(6),e.JRh(i.book.titulo),e.R7$(4),e.JRh(i.book.autor?e.bMT(11,7,i.book.autor):"AUTOR NO DISPONIBLE"),e.R7$(3),e.SpI("A\xf1o: ",i.book.anioPublicacion?i.book.anioPublicacion:"NO DISPONIBLE",""),e.R7$(),e.Mz_("alt","Portada de ",i.book.titulo,""),e.Y8G("src","https://proxy-euf.hosted.exlibrisgroup.com/exl_rewrite/syndetics.com/index.php?client=primo&isbn="+i.book.isbn+"/lc.jpg",e.B4B),e.R7$(2),e.vxM(i.selectedOption?17:16))},dependencies:[H,I,A,F,k.JJ,k.X6,k.Vh,k.bZ,k.bU,u.WX,C.rl,C.RG,C.nJ,C.yw,j.fS,j.fg,be,u.wT,_.YN,_.me,_.BC,_.vS,_.X1,O.UpperCasePipe],styles:[".modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:grid;place-items:center;z-index:1000;padding:1rem;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);animation:_ngcontent-%COMP%_fadeIn .5s ease}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:10px;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;position:relative;animation:_ngcontent-%COMP%_slideUp .5s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:.8}to{transform:translateY(0);opacity:1}}.close-btn[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;border:none;background:transparent;font-size:1.5rem;cursor:pointer}.modal-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;margin-bottom:1rem}@media (min-width: 768px){.modal-body[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;align-items:start}}.modal-body[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto;object-fit:contain;min-width:100%}.seleccion[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-top:1rem;border-radius:8px;cursor:pointer;border:1px solid rgb(223,227,235,1)}.demo-inline-calendar-card[_ngcontent-%COMP%]{width:100%!important;max-width:300px;margin:0 auto}.header-radio[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;padding:.2rem;font-size:1.3rem}.header-radio[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.radio[_ngcontent-%COMP%]{transform:scale(1.5);margin-right:1rem;cursor:pointer}.reserva[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-style:italic;font-weight:200}.alquiler[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .club[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:auto;object-fit:cover;align-items:center}.book-anio[_ngcontent-%COMP%]{font-weight:600}.back-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1rem;color:#007bff;cursor:pointer;margin-bottom:1rem}.demo-inline-calendar-card[_ngcontent-%COMP%]{width:300px}.mat-datepicker-content[_ngcontent-%COMP%], .cdk-overlay-container[_ngcontent-%COMP%], .cdk-overlay-pane[_ngcontent-%COMP%]{z-index:99999999!important}.mat-calendar-body-disabled[_ngcontent-%COMP%]{background-color:#ffebee;text-decoration:line-through}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.primero[_ngcontent-%COMP%]{width:auto;padding:0;margin:0}.salas[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-top:1rem}@media (min-width: 480px){.salas[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}.mat-form-field[_ngcontent-%COMP%]{width:100%!important}.selected[_ngcontent-%COMP%]{border:3px solid #3f51b5;background-color:#3f51b51a}.mat-mdc-card-content[_ngcontent-%COMP%]{padding:0}.estilo-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.7rem 1.2rem;background-color:#e74c3c;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:500;transition:all .2s}.estilo-btn[_ngcontent-%COMP%]:hover{background-color:#c0392b;transform:translateY(-2px)}.estilo-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.1rem}.parafoDescrip[_ngcontent-%COMP%]{padding:.3rem}"]})}return n})()}}]);