"use strict";(self.webpackChunkbiblioteca=self.webpackChunkbiblioteca||[]).push([[125],{1125:(b,s,c)=>{c.r(s),c.d(s,{ReservaModalComponent:()=>u});var e=c(4438),l=c(177),d=c(6218);function p(i,h){if(1&i){const t=e.RV6();e.j41(0,"button",18),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.cancelarReserva(null==o.respuestaAp?null:o.respuestaAp.id))}),e.j41(1,"span",3),e.EFF(2,"delete"),e.k0s(),e.EFF(3," Cancelar reserva "),e.k0s()}}let u=(()=>{class i{bibliotecaService;cdr;book=null;respuestaAp=null;tipo="actual";readOnly=!1;close=new e.bkB;constructor(t,n){this.bibliotecaService=t,this.cdr=n}ngOnInit(){this.book&&(console.log("Fecha recogida:",this.respuestaAp?.fechaRecogida),console.log("Fecha devoluci\xf3n:",this.respuestaAp?.fechaDevolucion),console.log("Tipo de fecha recogida:",typeof this.respuestaAp?.fechaRecogida))}useABEBooksCover(t,n){const o=t.target;if(o.errorHandled)return;o.errorHandled=!0;const r=n.replaceAll("-","").slice(0,15);o.src=`https://pictures.abebooks.com/isbn/${r}-es.jpg`,o.onerror=a=>{a instanceof Event&&this.useOLBooksCover(a,n)}}useOLBooksCover(t,n){const o=t.target;o.src=`https://covers.openlibrary.org/b/isbn/${n}-L.jpg`,o.onload=()=>{(o.naturalWidth<50||o.naturalHeight<50)&&this.useLocalImage(o)},o.onerror=r=>{r instanceof Event&&this.useGoogleFallback(r,n)}}useGoogleFallback(t,n){const o=t.target,r=n.replaceAll("-","");o.src=`http://books.google.com/books/content?vid=ISBN${r}&printsec=frontcover&img=1&zoom=1`,o.onerror=a=>{this.useLocalImage(o)}}useLocalImage(t){t.src="assets/libro.png",t.onerror=null,t.classList.add("local-cover")}checkImageSize(t,n){const o=t.target;(o.naturalWidth<50||o.naturalHeight<50)&&this.useLocalImage(o),this.cdr.detectChanges()}cerrar(t){this.close.emit()}formatDate(t){if(!Array.isArray(t))return"Formato de fecha inv\xe1lido";try{if(t.length<5)return"Fecha incompleta";const n=new Date(t[0],t[1]-1,t[2],t[3],t[4]);if(isNaN(n.getTime()))return"Fecha inv\xe1lida";const o=n.getDate(),r=this.getMonthName(n.getMonth()+1),a=n.getFullYear();return`${o} de ${r} de ${a}, ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`}catch(n){return console.error("Error formateando fecha:",n),"Error formateando fecha"}}getMonthName(t){return["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][t-1]||""}cancelarReserva(t){t?this.bibliotecaService.deleteIAlquiler(t).subscribe({next:()=>{alert("Has borrado tu reserva de libro con exito."),this.close.emit()},error:n=>{console.error("Error creando club:",n),alert(n.error?.message||"Ha ocurrido un error al cancelar la reserva.")}}):console.error("ID no v\xe1lido para cancelar la reserva")}puedeEliminar(t){const n=new Date,o=new Date(t);return n.setHours(0,0,0,0),o.setHours(0,0,0,0),o>=n}static \u0275fac=function(n){return new(n||i)(e.rXU(d.y),e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:i,selectors:[["app-reserva-modal"]],inputs:{book:"book",respuestaAp:"respuestaAp",tipo:"tipo",readOnly:"readOnly"},outputs:{close:"close"},standalone:!0,features:[e.aNF],decls:35,vars:11,consts:[[1,"modal",3,"click"],[1,"modal-content",3,"click"],[1,"close-btn",3,"click"],[1,"material-icons"],[1,"modal-header"],[1,"modal-body"],[1,"book-cover-section"],[1,"book-cover",3,"error","load","src","alt"],[1,"book-info-section"],[1,"book-details"],[1,"book-title"],[1,"book-author"],[1,"detail-row"],[1,"detail-label"],[1,"detail-value"],[1,"detail-value","highlight"],[1,"actions"],[1,"cancel-btn"],[1,"cancel-btn",3,"click"]],template:function(n,o){1&n&&(e.j41(0,"div",0),e.bIt("click",function(a){return o.cerrar(a)}),e.j41(1,"div",1),e.bIt("click",function(a){return a.stopPropagation()}),e.j41(2,"button",2),e.bIt("click",function(){return o.close.emit()}),e.j41(3,"span",3),e.EFF(4,"close"),e.k0s()(),e.j41(5,"div",4)(6,"h2"),e.EFF(7,"Detalles de tu reserva"),e.k0s()(),e.j41(8,"div",5)(9,"div",6)(10,"img",7),e.bIt("error",function(a){return o.useABEBooksCover(a,o.book.isbn)})("load",function(a){return o.checkImageSize(a,o.book)}),e.k0s()(),e.j41(11,"div",8)(12,"div",9)(13,"h3",10),e.EFF(14),e.k0s(),e.j41(15,"p",11),e.EFF(16),e.nI1(17,"uppercase"),e.k0s(),e.j41(18,"div",12)(19,"span",13),e.EFF(20,"A\xf1o de publicaci\xf3n:"),e.k0s(),e.j41(21,"span",14),e.EFF(22),e.k0s()(),e.j41(23,"div",12)(24,"span",13),e.EFF(25,"Inicio de reserva:"),e.k0s(),e.j41(26,"span",15),e.EFF(27),e.k0s()(),e.j41(28,"div",12)(29,"span",13),e.EFF(30,"Fin de reserva:"),e.k0s(),e.j41(31,"span",15),e.EFF(32),e.k0s()()(),e.j41(33,"div",16),e.DNE(34,p,4,0,"button",17),e.k0s()()()()()),2&n&&(e.R7$(10),e.Mz_("alt","Portada de ",o.book.titulo,""),e.Y8G("src","https://proxy-euf.hosted.exlibrisgroup.com/exl_rewrite/syndetics.com/index.php?client=primo&isbn="+o.book.isbn+"/lc.jpg",e.B4B),e.R7$(4),e.JRh(o.book.titulo),e.R7$(2),e.JRh(e.bMT(17,9,o.book.autor)),e.R7$(6),e.JRh(o.book.anioPublicacion),e.R7$(5),e.JRh(o.formatDate((null==o.respuestaAp?null:o.respuestaAp.fechaRecogida)||"")),e.R7$(5),e.JRh(o.formatDate((null==o.respuestaAp?null:o.respuestaAp.fechaDevolucion)||"")),e.R7$(2),e.vxM("historial"!==o.tipo?34:-1))},dependencies:[l.UpperCasePipe],styles:[".modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000b3;display:grid;place-items:center;z-index:1000;padding:1rem;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);animation:_ngcontent-%COMP%_fadeIn .3s ease}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;width:90%;max-width:700px;max-height:90vh;overflow-y:auto;position:relative;box-shadow:0 10px 25px #0003;animation:_ngcontent-%COMP%_slideUp .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:.8}to{transform:translateY(0);opacity:1}}.close-btn[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;border:none;background:transparent;font-size:1.5rem;cursor:pointer;color:#666;transition:color .2s;padding:.5rem;border-radius:50%}.close-btn[_ngcontent-%COMP%]:hover{color:#333;background:#f5f5f5}.modal-header[_ngcontent-%COMP%]{margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid #eee}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-size:1.5rem}.modal-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.book-cover-section[_ngcontent-%COMP%]{display:flex;justify-content:center}.book-cover[_ngcontent-%COMP%]{max-width:100%;height:auto;max-height:300px;object-fit:contain;border-radius:6px;box-shadow:0 4px 12px #00000026}.book-info-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.book-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.book-title[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-size:1.3rem;line-height:1.3}.book-author[_ngcontent-%COMP%]{margin:0;color:#7f8c8d;font-size:1rem}.detail-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;align-items:baseline}.detail-label[_ngcontent-%COMP%]{font-weight:600;color:#34495e;font-size:.9rem}.detail-value[_ngcontent-%COMP%]{color:#2c3e50;font-size:.95rem}.highlight[_ngcontent-%COMP%]{color:#e74c3c;font-weight:600}.actions[_ngcontent-%COMP%]{margin-top:1rem;display:flex;justify-content:flex-end}.cancel-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.7rem 1.2rem;background-color:#e74c3c;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:500;transition:all .2s}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#c0392b;transform:translateY(-2px)}.cancel-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.1rem}@media (min-width: 768px){.modal-body[_ngcontent-%COMP%]{flex-direction:row}.book-cover-section[_ngcontent-%COMP%]{flex:0 0 40%}.book-info-section[_ngcontent-%COMP%]{flex:1}.book-cover[_ngcontent-%COMP%]{max-height:350px}}@media (max-width: 480px){.modal-content[_ngcontent-%COMP%]{padding:1.5rem}.detail-row[_ngcontent-%COMP%]{flex-direction:column;gap:.2rem}.actions[_ngcontent-%COMP%]{justify-content:center}.cancel-btn[_ngcontent-%COMP%]{width:100%;justify-content:center}}"]})}return i})()}}]);